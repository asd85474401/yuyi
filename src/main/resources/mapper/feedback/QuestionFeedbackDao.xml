<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kcidea.erms.dao.feedback.QuestionFeedbackDao">

    <select id="findListBySidDidTitleTypeIdCheckStateCheckFlagPage"
            resultType="com.kcidea.erms.model.feedback.FeedbackModel">
        select id,feedback_title,feedback_content,name,identity,unit,feedback_time,type_id,d_id,check_state,remark
        from question_feedback
        where s_id = #{sid}
        <if test="did !=null and did != 999">
            and d_id = #{did}
        </if>
        <if test="title != null and title != ''">
            and feedback_title like concat('%',#{title},'%')
        </if>
        <if test="typeId !=null and typeId != 999">
            and type_id = #{typeId}
        </if>
        <if test="checkState !=null and checkState != 999">
            and check_state = #{checkState}
        </if>
        <if test="checkFlag">
            and check_state != 0
        </if>
        order by FIELD(`check_state`,1,3,2),feedback_time desc
    </select>
    <select id="findOneByIdSid" resultType="com.kcidea.erms.domain.feedback.QuestionFeedback">
        select * from question_feedback
        where s_id = #{sid} and id = #{feedbackId}
    </select>
    <select id="findDidListBySid" resultType="java.lang.Long">
        select distinct d_id from question_feedback
        where s_id = #{sid}
    </select>
    <select id="findOneByFeedbackTitle" resultType="com.kcidea.erms.model.feedback.FeedbackInfoModel">
        select * from question_feedback
        where feedback_title = #{feedbackTitle}
    </select>
</mapper>
